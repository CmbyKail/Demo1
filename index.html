<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>情商训练营 (EQ Trainer)</title>
    <!-- Fonts: Fredoka (Headings) & Nunito (Body) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <!-- Chart.js (Local) -->
    <script src="js/chart.js"></script>
</head>
<body>
    <header>
        <h1>情商训练营</h1>
        <div class="header-actions">
            <button id="add-scenario-btn" class="icon-btn" title="添加自定义题目">➕</button>
            <button id="settings-btn" class="icon-btn" title="设置">⚙️</button>
        </div>
    </header>

    <main id="app">
        <!-- 欢迎界面 -->
        <section id="welcome-view" class="view active">
            <!-- Hero / Start Training Section (Moved to Top) -->
            <div class="hero-section" style="text-align: center; margin-bottom: 3rem;">
                <h2 style="font-size: 2rem; color: var(--primary-color); margin-bottom: 0.5rem;">开启你的情商之旅</h2>
                <p style="color: var(--text-light); margin-bottom: 2rem;">选择一个场景，开始今天的修炼</p>
                <div id="category-list" class="grid-container">
                    <!-- 动态生成 -->
                </div>
            </div>

            <!-- Gamification & Stats (Moved Below) -->
            <div class="dashboard-grid" style="display: grid; gap: 2rem; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
                
                <!-- Left Column: Progress -->
                <div class="dashboard-col">
                    <h3 style="font-size: 1.2rem; margin-bottom: 1rem;">我的进度</h3>
                    <!-- Gamification Bar -->
                    <div id="gamification-bar" class="gamification-container clay-card" style="margin-bottom: 1.5rem; padding: 1.5rem;">
                        <div class="level-info" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div class="level-badge" style="background: var(--accent-color); color: white; padding: 0.4rem 1rem; border-radius: 20px; font-weight: bold; font-size: 1.1rem;">Lv.<span id="user-level">1</span></div>
                            <div class="xp-bar-container" style="flex: 1; height: 12px; background: #eee; border-radius: 6px; position: relative; overflow: hidden;">
                                <div id="xp-bar-fill" class="xp-bar-fill" style="width: 0%; height: 100%; background: var(--primary-color); transition: width 0.5s;"></div>
                            </div>
                        </div>
                        <div style="text-align: right; font-size: 0.9rem; color: var(--text-light); margin-bottom: 1rem;">
                            <span id="user-xp">0</span> / <span id="next-level-xp">500</span> XP
                        </div>
                        <div id="badge-wall" class="badge-wall" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <!-- Badges rendered here -->
                        </div>
                    </div>

                    <!-- Daily Challenge -->
                    <div id="daily-challenge-card" class="clay-card daily-challenge" style="margin-bottom: 1.5rem; padding: 1.5rem;">
                        <div class="daily-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="margin: 0; font-size: 1.1rem;">🔥 每日挑战 (双倍经验)</h3>
                            <button id="start-daily-btn" class="primary-btn small" style="padding: 0.4rem 1rem; font-size: 0.9rem;">Go!</button>
                        </div>
                        <p id="daily-title" style="margin: 0; color: var(--text-color); font-weight: 600;">正在加载...</p>
                    </div>
                </div>

                <!-- Right Column: Stats -->
                <div class="dashboard-col">
                    <h3 style="font-size: 1.2rem; margin-bottom: 1rem;">能力分析</h3>
                    <!-- Stats Dashboard -->
                    <div id="stats-dashboard" class="stats-dashboard clay-card" style="margin-bottom: 1.5rem; padding: 1.5rem;">
                        <div class="stats-content" style="display: flex; flex-direction: column; gap: 1.5rem;">
                            <div class="radar-container" style="width: 100%; max-width: 250px; margin: 0 auto;">
                                <canvas id="ability-radar"></canvas>
                            </div>
                            <div class="stats-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="stat-item" style="text-align: center; background: #F8FAFC; padding: 0.8rem; border-radius: 12px;">
                                    <div class="stat-label" style="font-size: 0.8rem; color: var(--text-light);">总训练</div>
                                    <div id="stat-total" class="stat-value" style="font-size: 1.2rem; font-weight: bold; color: var(--text-color);">0</div>
                                </div>
                                <div class="stat-item" style="text-align: center; background: #F8FAFC; padding: 0.8rem; border-radius: 12px;">
                                    <div class="stat-label" style="font-size: 0.8rem; color: var(--text-light);">平均分</div>
                                    <div id="stat-avg" class="stat-value" style="font-size: 1.2rem; font-weight: bold; color: var(--text-color);">0</div>
                                </div>
                            </div>
                            <div id="weakness-tip" class="weakness-tip" style="background: #EFF6FF; padding: 1rem; border-radius: 12px; font-size: 0.9rem; color: var(--primary-dark); border-left: 4px solid var(--primary-color);">
                                💡 建议: <span id="weakness-text">快开始第一次训练吧！</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="contribution-section clay-card" style="margin-top: 1.5rem; padding: 1.5rem;">
                <h3 style="font-size: 1.1rem; margin-bottom: 1rem;">📅 训练热力图</h3>
                <div id="contribution-graph" class="contribution-grid">
                    <!-- JS 渲染 -->
                </div>
            </div>

            <!-- Recommended (Hidden initially) -->
            <div id="recommendation-card" class="clay-card hidden" style="margin-bottom: 1.5rem; padding: 1rem; border-left: 5px solid var(--primary-color);">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.5rem;">
                    <h4 style="margin:0; font-size:1rem; color:var(--primary-dark);">💡 专属推荐：<span id="rec-reason"></span></h4>
                    <span class="tag" style="font-size:0.7rem;">AI精选</span>
                </div>
                <div id="rec-scenario-content" style="cursor:pointer; padding:0.5rem; border-radius:8px; transition:background 0.2s;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:0.3rem;">
                        <strong id="rec-title" style="font-size:1.1rem;"></strong>
                        <span id="rec-cat" style="font-size:0.8rem; color:var(--text-light); border:1px solid #eee; padding:0 2px; border-radius:4px;"></span>
                    </div>
                    <p id="rec-desc" style="font-size:0.9rem; color:#666; margin:0; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;"></p>
                    <div style="text-align:right; margin-top:0.5rem; font-size:0.8rem; color:var(--accent-color); font-weight:bold;">点击开始练习 &rarr;</div>
                </div>
            </div>

            <div class="history-summary">
                <h3>历史记录</h3>
                <ul id="history-list"></ul>
            </div>
        </section>

        <!-- 训练界面 -->
        <section id="training-view" class="view hidden">
            <div class="clay-card">
                <div class="scenario-header">
                    <span id="scenario-category" class="tag">职场</span>
                    <button id="fav-btn" class="fav-btn" title="收藏本题">☆</button>
                    <span id="timer" class="timer">02:00</span>
                </div>
                <h3 id="scenario-title">场景标题</h3>
                <p id="scenario-description">场景描述内容...</p>
                <div class="scenario-context">
                    <strong>背景：</strong> <span id="scenario-context">...</span>
                </div>
            </div>

            <!-- Mode Toggle -->
            <div class="mode-toggle" style="display:flex; justify-content:center; gap:2rem; margin-bottom:1rem;">
                <label style="cursor:pointer; font-weight:bold;">
                    <input type="radio" name="training-mode" value="single" checked> 单次回答模式
                </label>
                <label style="cursor:pointer; font-weight:bold; color:var(--primary-color);">
                    <input type="radio" name="training-mode" value="chat"> AI模拟对话 (Beta)
                </label>
            </div>

            <div id="single-mode-area" class="answer-area">
                <textarea id="user-answer" placeholder="你会怎么回答？（限时2分钟）"></textarea>
                <div class="training-actions" style="display:flex;gap:1rem;justify-content:flex-end;margin-top:1rem;">
                    <button id="cancel-training-btn" class="secondary-btn">放弃返回</button>
                    <button id="submit-btn" class="primary-btn">提交回答</button>
                </div>
            </div>

            <div id="chat-mode-area" class="answer-area hidden">
                <div id="chat-history" class="chat-history clay-card" style="height: 300px; overflow-y: auto; padding: 1rem; background: rgba(255,255,255,0.5);">
                    <div class="chat-msg system">
                        <span>正在初始化角色...</span>
                    </div>
                </div>
                <div class="chat-input-area" style="display:flex; gap:0.5rem; margin-top:1rem;">
                    <input type="text" id="chat-input" placeholder="输入你的回复..." style="flex:1; min-height:50px;">
                    <button id="send-chat-btn" class="primary-btn" style="padding:0 1.5rem;">发送</button>
                </div>
                <div class="training-actions" style="display:flex;gap:1rem;justify-content:flex-end;margin-top:1rem;">
                    <button id="end-chat-btn" class="secondary-btn" style="background:#ff7675;color:white;">结束对话并评估</button>
                </div>
            </div>
        </section>

        <!-- 反馈界面 -->
        <section id="feedback-view" class="view hidden">
            <div class="score-card">
                <div class="score-circle">
                    <span id="feedback-score">--</span>
                    <span class="label">分</span>
                </div>
                <h3>AI 智能点评</h3>
            </div>

            <div class="feedback-grid">
                <div class="feedback-item pros">
                    <h4>✅ 亮点</h4>
                    <ul id="feedback-pros"></ul>
                </div>
                <div class="feedback-item cons">
                    <h4>⚠️ 改进建议</h4>
                    <ul id="feedback-cons"></ul>
                </div>
            </div>

            <div class="model-answer-section clay-card">
                <h4>🧠 曾仕强智慧指引</h4>
                <blockquote id="zeng-quote"></blockquote>
                <h4>🔑 核心公式</h4>
                <p id="feedback-formula" class="formula-box">暂无公式</p>
                <h4>📝 参考回答</h4>
                <p id="model-answer"></p>
            </div>

            <div class="action-buttons" style="display:flex;gap:1rem;justify-content:center;margin-top:2rem;">
                <button id="practice-similar-btn" class="primary-btn">举一反三 (练习类似题)</button>
                <button id="back-home-btn" class="secondary-btn">返回主页</button>
            </div>
        </section>
    </main>

    <!-- 设置模态框 -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <h3>设置</h3>
            <div class="form-group">
                <label for="api-endpoint">API Endpoint</label>
                <input type="text" id="api-endpoint" placeholder="https://ark.cn-beijing.volces.com/api/v3/chat/completions">
            </div>
            <div class="form-group">
                <label for="api-key">API Key</label>
                <input type="password" id="api-key" placeholder="sk-...">
            </div>
            <div class="form-group">
                <label for="api-model">Model Name</label>
                <input type="text" id="api-model" value="doubao-seed-1-8-251228">
            </div>
            <div class="form-group" style="border-top: 1px solid #eee; padding-top: 1rem; margin-top: 1rem;">
                <label>开发者选项</label>
                <button id="inject-test-data-btn" class="secondary-btn" style="width:100%;font-size:0.9rem;">🛠️ 写入测试数据 (用于演示)</button>
            </div>
            <div class="modal-actions">
                <button id="save-settings-btn" class="primary-btn">保存</button>
                <button id="cancel-settings-btn" class="secondary-btn">取消</button>
            </div>
        </div>
    </div>

    <!-- 添加场景模态框 -->
    <div id="add-scenario-modal" class="modal hidden">
        <div class="modal-content">
            <h3>添加自定义题目</h3>
            <div class="form-group">
                <label for="custom-title">标题</label>
                <input type="text" id="custom-title" placeholder="例如：遇到杠精同事">
            </div>
            <div class="form-group">
                <label for="custom-category">分类</label>
                <select id="custom-category">
                    <option value="职场">职场</option>
                    <option value="情感">情感</option>
                    <option value="家庭">家庭</option>
                    <option value="学术">学术</option>
                    <option value="社交">社交</option>
                    <option value="突发">突发</option>
                    <option value="自定义">自定义</option>
                </select>
            </div>
            <div class="form-group">
                <label for="custom-desc">描述</label>
                <textarea id="custom-desc" rows="3" placeholder="详细描述发生的事情..."></textarea>
            </div>
            <div class="form-group">
                <label for="custom-context">背景</label>
                <input type="text" id="custom-context" placeholder="例如：周五下午，办公室">
            </div>
            <div class="modal-actions">
                <button id="save-scenario-btn" class="primary-btn">保存</button>
                <button id="cancel-scenario-btn" class="secondary-btn">取消</button>
            </div>
        </div>
    </div>

    <!-- 历史详情模态框 -->
    <div id="history-modal" class="modal hidden">
        <div class="modal-content">
            <h3>历史记录详情</h3>
            <div class="clay-card" style="margin-bottom:1rem;padding:1rem;">
                <h4 id="hist-title">场景标题</h4>
                <p id="hist-answer" style="color:#666;font-style:italic;">用户的回答...</p>
            </div>
            <div class="clay-card" style="margin-bottom:1rem;padding:1rem;">
                <h4>得分: <span id="hist-score" style="color:var(--primary-color);font-weight:bold;">85</span></h4>
                <div id="hist-feedback"></div>
                <div id="hist-formula-container" style="margin-top:1rem;border-top:1px solid #eee;padding-top:0.5rem;">
                    <strong>🔑 核心公式:</strong>
                    <p id="hist-formula" style="color:var(--primary-color);font-weight:bold;margin-top:0.5rem;"></p>
                </div>
            </div>
            <div class="clay-card" style="padding:1rem;">
                <h4>参考回答</h4>
                <p id="hist-model"></p>
            </div>
            <div class="modal-actions">
                <button id="hist-practice-btn" class="primary-btn" style="font-size:0.9rem;padding:0.5rem 1rem;">举一反三</button>
                <button id="close-history-btn" class="secondary-btn">关闭</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/app.js?v=4"></script>
</body>
</html>
